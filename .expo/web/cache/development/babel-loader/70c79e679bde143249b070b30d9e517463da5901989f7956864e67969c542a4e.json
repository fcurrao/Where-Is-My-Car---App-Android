{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport React, { useEffect, useState } from \"react\";\nimport * as Location from \"expo-location\";\nimport AddButton from \"../Components/AddButton\";\nimport { usePostUserLocationMutation } from \"../Services/shopServices\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { setUserLocation } from \"../features/User/userSlice\";\nimport { colors } from \"../Global/Colors\";\nimport MapPreview from \"../Components/MapPreview\";\nimport { google_maps_api_key } from \"../Database/firebaseConfig\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nvar LocationSelector = function LocationSelector(_ref) {\n  var navigation = _ref.navigation;\n  var _useState = useState({\n      latitude: \"\",\n      longitude: \"\"\n    }),\n    _useState2 = _slicedToArray(_useState, 2),\n    location = _useState2[0],\n    setLocation = _useState2[1];\n  var _useState3 = useState(\"\"),\n    _useState4 = _slicedToArray(_useState3, 2),\n    error = _useState4[0],\n    setError = _useState4[1];\n  var _useState5 = useState(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    address = _useState6[0],\n    setAddress = _useState6[1];\n  var _useSelector = useSelector(function (state) {\n      return state.userReducer.value;\n    }),\n    localId = _useSelector.localId;\n  var _usePostUserLocationM = usePostUserLocationMutation(),\n    _usePostUserLocationM2 = _slicedToArray(_usePostUserLocationM, 2),\n    triggerPostAddress = _usePostUserLocationM2[0],\n    result = _usePostUserLocationM2[1];\n  var dispatch = useDispatch();\n  var onConfirmAddress = function onConfirmAddress(ad, loc1, loc2) {\n    alert(\"Direccion cambiada\");\n    alert(\"Direccion \", ad);\n    alert(\"Direccion loc1\", loc1);\n    alert(\"Direccion loc2\", loc2);\n    var locationFormatted = {\n      latitude: location.latitude,\n      longitude: location.longitude,\n      address: address\n    };\n    dispatch(setUserLocation(locationFormatted));\n    triggerPostAddress({\n      location: locationFormatted,\n      localId: localId\n    });\n    navigation.goBack();\n  };\n  useEffect(function () {\n    _asyncToGenerator(function* () {\n      try {\n        var _yield$Location$reque = yield Location.requestForegroundPermissionsAsync(),\n          status = _yield$Location$reque.status;\n        if (status !== \"granted\") {\n          setError(\"Permission to access location was denied\");\n          return;\n        }\n        var _location = yield Location.getCurrentPositionAsync({});\n        setLocation({\n          latitude: _location.coords.latitude,\n          longitude: _location.coords.longitude\n        });\n      } catch (error) {\n        alert(\"esto fue un error\");\n        console.log(\"esto fue un error\", error.message);\n        setError(error.message);\n      }\n    })();\n  }, []);\n  useEffect(function () {\n    _asyncToGenerator(function* () {\n      try {\n        if (location.latitude) {\n          var url_reverse_geocode = \"https://maps.googleapis.com/maps/api/geocode/json?latlng=\" + location.latitude + \",\" + location.longitude + \"&key=\" + google_maps_api_key;\n          var response = yield fetch(url_reverse_geocode);\n          var data = yield response.json();\n          setAddress(data.results[0].formatted_address);\n        }\n      } catch (error) {\n        setError(error.message);\n      }\n    })();\n  }, [location]);\n  return _jsxs(View, {\n    style: styles.container,\n    children: [_jsx(Text, {\n      style: styles.text,\n      children: \"My Address\"\n    }), location ? _jsxs(_Fragment, {\n      children: [_jsxs(Text, {\n        style: styles.text,\n        children: [\"Lat: \", location.latitude, \", long: \", location.longitude, \".\"]\n      }), _jsx(MapPreview, {\n        location: location\n      }), _jsxs(Text, {\n        style: styles.address,\n        children: [\"Adress: \", address]\n      }), _jsx(AddButton, {\n        onPress: onConfirmAddress(address, location.latitude, location.longitude),\n        title: \"Confirm address\"\n      })]\n    }) : _jsx(_Fragment, {\n      children: _jsx(View, {\n        style: styles.noLocationContainer,\n        children: _jsx(Text, {\n          children: error\n        })\n      })\n    })]\n  });\n};\nexport default LocationSelector;\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"flex-start\"\n  },\n  text: {\n    paddingTop: 20,\n    fontFamily: 'Josefin',\n    fontSize: 18\n  },\n  noLocationContainer: {\n    width: 200,\n    height: 200,\n    borderWidth: 2,\n    borderColor: colors.peach,\n    padding: 10,\n    justifyContent: \"center\",\n    alignItems: \"center\"\n  },\n  address: {\n    padding: 10,\n    fontSize: 16\n  }\n});","map":{"version":3,"names":["React","useEffect","useState","Location","AddButton","usePostUserLocationMutation","useDispatch","useSelector","setUserLocation","colors","MapPreview","google_maps_api_key","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","LocationSelector","_ref","navigation","_useState","latitude","longitude","_useState2","_slicedToArray","location","setLocation","_useState3","_useState4","error","setError","_useState5","_useState6","address","setAddress","_useSelector","state","userReducer","value","localId","_usePostUserLocationM","_usePostUserLocationM2","triggerPostAddress","result","dispatch","onConfirmAddress","ad","loc1","loc2","alert","locationFormatted","goBack","_asyncToGenerator","_yield$Location$reque","requestForegroundPermissionsAsync","status","getCurrentPositionAsync","coords","console","log","message","url_reverse_geocode","response","fetch","data","json","results","formatted_address","View","style","styles","container","children","Text","text","onPress","title","noLocationContainer","StyleSheet","create","flex","alignItems","justifyContent","paddingTop","fontFamily","fontSize","width","height","borderWidth","borderColor","peach","padding"],"sources":["C:/Users/federico.currao/Desktop/OtrosFC/mycar/Where-Is-My-Car---App-Android/src/Screens/LocationSelector.jsx"],"sourcesContent":["import { StyleSheet, Text, View } from \"react-native\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport * as Location from \"expo-location\";\r\nimport AddButton from \"../Components/AddButton\";\r\nimport { usePostUserLocationMutation } from \"../Services/shopServices\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { setUserLocation } from \"../features/User/userSlice\";\r\nimport { colors } from \"../Global/Colors\";\r\nimport MapPreview from \"../Components/MapPreview\";\r\nimport { google_maps_api_key } from \"../Database/firebaseConfig\";\r\n\r\nconst LocationSelector = ({ navigation }) => {\r\n\r\n    const [location, setLocation] = useState({ latitude: \"\", longitude: \"\" });\r\n    const [error, setError] = useState(\"\");\r\n\r\n    const [address, setAddress] = useState(null);\r\n\r\n    const {localId} = useSelector(state => state.userReducer.value)\r\n    const [triggerPostAddress, result] = usePostUserLocationMutation();\r\n    const dispatch = useDispatch(); \r\n\r\n    const onConfirmAddress = (ad,loc1,loc2) => {\r\n        alert(\"Direccion cambiada\")\r\n        alert(\"Direccion \", ad)\r\n        alert(\"Direccion loc1\",loc1)\r\n        alert(\"Direccion loc2\", loc2)\r\n         const locationFormatted = {\r\n            latitude: location.latitude,\r\n            longitude: location.longitude,\r\n            address: address\r\n        }\r\n        dispatch(setUserLocation(locationFormatted))\r\n        \r\n        triggerPostAddress({location: locationFormatted, localId})  \r\n         navigation.goBack()\r\n    }\r\n    \r\n    //Location requested on mount\r\n    useEffect(() => {\r\n        (async () => {\r\n            try {\r\n                let { status } = await Location.requestForegroundPermissionsAsync();\r\n                if (status !== \"granted\") {\r\n                    setError(\"Permission to access location was denied\");\r\n                    return;\r\n                }\r\n    \r\n                let location = await Location.getCurrentPositionAsync({});\r\n                setLocation({\r\n                    latitude: location.coords.latitude,\r\n                    longitude: location.coords.longitude,\r\n                });\r\n                \r\n            } catch (error) {\r\n                alert(\"esto fue un error\")\r\n                console.log(\"esto fue un error\", error.message);\r\n                setError(error.message)\r\n            }\r\n        })();\r\n    }, []);\r\n\r\n    //Reverse geocoding\r\n    useEffect(() => {\r\n        (async () => {\r\n            try {\r\n                if (location.latitude) {\r\n                    const url_reverse_geocode = `https://maps.googleapis.com/maps/api/geocode/json?latlng=${location.latitude},${location.longitude}&key=${google_maps_api_key}`;\r\n                    const response = await fetch(url_reverse_geocode);\r\n                    const data = await response.json();\r\n                    setAddress(data.results[0].formatted_address);\r\n                }\r\n            } catch (error) {\r\n                setError(error.message);\r\n            }\r\n        })();\r\n    }, [location]);\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <Text\r\n                style = {styles.text}\r\n            >My Address</Text>\r\n            {/* Flatlist con las directions */}\r\n            {location ? (\r\n                <>\r\n                    <Text \r\n                        style = {styles.text}\r\n                    >Lat: {location.latitude}, long: {location.longitude}.\r\n                    </Text>\r\n                    <MapPreview location={location} />\r\n                    <Text style={styles.address}>\r\n                        Adress: {address}\r\n                    </Text>\r\n                    <AddButton\r\n                        onPress={onConfirmAddress(address, location.latitude, location.longitude)}\r\n                        title=\"Confirm address\"\r\n                    />\r\n                </>\r\n            ) : (\r\n                <>\r\n                    <View style={styles.noLocationContainer}>\r\n                        <Text>{error}</Text>\r\n                    </View>\r\n                </>\r\n            )}\r\n        </View>\r\n    );\r\n};\r\n\r\nexport default LocationSelector;\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        flex: 1,\r\n        alignItems: \"center\",\r\n        justifyContent: \"flex-start\",\r\n    },\r\n    text: {\r\n        paddingTop: 20,\r\n        fontFamily: 'Josefin',\r\n        fontSize: 18\r\n    },\r\n    noLocationContainer: {\r\n        width: 200,\r\n        height: 200,\r\n        borderWidth: 2,\r\n        borderColor: colors.peach,\r\n        padding: 10,\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n    },\r\n    address: {\r\n        padding: 10,\r\n        // fontFamily: \"Ubuntu\",\r\n        fontSize: 16,\r\n    },\r\n});"],"mappings":";;;;;AACA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAClD,OAAO,KAAKC,QAAQ,MAAM,eAAe;AACzC,OAAOC,SAAS;AAChB,SAASC,2BAA2B;AACpC,SAASC,WAAW,EAAEC,WAAW,QAAQ,aAAa;AACtD,SAASC,eAAe;AACxB,SAASC,MAAM;AACf,OAAOC,UAAU;AACjB,SAASC,mBAAmB;AAAqC,SAAAC,GAAA,IAAAC,IAAA;AAAA,SAAAC,IAAA,IAAAC,KAAA;AAAA,SAAAC,QAAA,IAAAC,SAAA;AAEjE,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAAC,IAAA,EAAuB;EAAA,IAAjBC,UAAU,GAAAD,IAAA,CAAVC,UAAU;EAElC,IAAAC,SAAA,GAAgCnB,QAAQ,CAAC;MAAEoB,QAAQ,EAAE,EAAE;MAAEC,SAAS,EAAE;IAAG,CAAC,CAAC;IAAAC,UAAA,GAAAC,cAAA,CAAAJ,SAAA;IAAlEK,QAAQ,GAAAF,UAAA;IAAEG,WAAW,GAAAH,UAAA;EAC5B,IAAAI,UAAA,GAA0B1B,QAAQ,CAAC,EAAE,CAAC;IAAA2B,UAAA,GAAAJ,cAAA,CAAAG,UAAA;IAA/BE,KAAK,GAAAD,UAAA;IAAEE,QAAQ,GAAAF,UAAA;EAEtB,IAAAG,UAAA,GAA8B9B,QAAQ,CAAC,IAAI,CAAC;IAAA+B,UAAA,GAAAR,cAAA,CAAAO,UAAA;IAArCE,OAAO,GAAAD,UAAA;IAAEE,UAAU,GAAAF,UAAA;EAE1B,IAAAG,YAAA,GAAkB7B,WAAW,CAAC,UAAA8B,KAAK;MAAA,OAAIA,KAAK,CAACC,WAAW,CAACC,KAAK;IAAA,EAAC;IAAxDC,OAAO,GAAAJ,YAAA,CAAPI,OAAO;EACd,IAAAC,qBAAA,GAAqCpC,2BAA2B,CAAC,CAAC;IAAAqC,sBAAA,GAAAjB,cAAA,CAAAgB,qBAAA;IAA3DE,kBAAkB,GAAAD,sBAAA;IAAEE,MAAM,GAAAF,sBAAA;EACjC,IAAMG,QAAQ,GAAGvC,WAAW,CAAC,CAAC;EAE9B,IAAMwC,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAIC,EAAE,EAACC,IAAI,EAACC,IAAI,EAAK;IACvCC,KAAK,CAAC,oBAAoB,CAAC;IAC3BA,KAAK,CAAC,YAAY,EAAEH,EAAE,CAAC;IACvBG,KAAK,CAAC,gBAAgB,EAACF,IAAI,CAAC;IAC5BE,KAAK,CAAC,gBAAgB,EAAED,IAAI,CAAC;IAC5B,IAAME,iBAAiB,GAAG;MACvB7B,QAAQ,EAAEI,QAAQ,CAACJ,QAAQ;MAC3BC,SAAS,EAAEG,QAAQ,CAACH,SAAS;MAC7BW,OAAO,EAAEA;IACb,CAAC;IACDW,QAAQ,CAACrC,eAAe,CAAC2C,iBAAiB,CAAC,CAAC;IAE5CR,kBAAkB,CAAC;MAACjB,QAAQ,EAAEyB,iBAAiB;MAAEX,OAAO,EAAPA;IAAO,CAAC,CAAC;IACzDpB,UAAU,CAACgC,MAAM,CAAC,CAAC;EACxB,CAAC;EAGDnD,SAAS,CAAC,YAAM;IACZoD,iBAAA,CAAC,aAAY;MACT,IAAI;QACA,IAAAC,qBAAA,SAAuBnD,QAAQ,CAACoD,iCAAiC,CAAC,CAAC;UAA7DC,MAAM,GAAAF,qBAAA,CAANE,MAAM;QACZ,IAAIA,MAAM,KAAK,SAAS,EAAE;UACtBzB,QAAQ,CAAC,0CAA0C,CAAC;UACpD;QACJ;QAEA,IAAIL,SAAQ,SAASvB,QAAQ,CAACsD,uBAAuB,CAAC,CAAC,CAAC,CAAC;QACzD9B,WAAW,CAAC;UACRL,QAAQ,EAAEI,SAAQ,CAACgC,MAAM,CAACpC,QAAQ;UAClCC,SAAS,EAAEG,SAAQ,CAACgC,MAAM,CAACnC;QAC/B,CAAC,CAAC;MAEN,CAAC,CAAC,OAAOO,KAAK,EAAE;QACZoB,KAAK,CAAC,mBAAmB,CAAC;QAC1BS,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAE9B,KAAK,CAAC+B,OAAO,CAAC;QAC/C9B,QAAQ,CAACD,KAAK,CAAC+B,OAAO,CAAC;MAC3B;IACJ,CAAC,EAAE,CAAC;EACR,CAAC,EAAE,EAAE,CAAC;EAGN5D,SAAS,CAAC,YAAM;IACZoD,iBAAA,CAAC,aAAY;MACT,IAAI;QACA,IAAI3B,QAAQ,CAACJ,QAAQ,EAAE;UACnB,IAAMwC,mBAAmB,iEAA+DpC,QAAQ,CAACJ,QAAQ,SAAII,QAAQ,CAACH,SAAS,aAAQZ,mBAAqB;UAC5J,IAAMoD,QAAQ,SAASC,KAAK,CAACF,mBAAmB,CAAC;UACjD,IAAMG,IAAI,SAASF,QAAQ,CAACG,IAAI,CAAC,CAAC;UAClC/B,UAAU,CAAC8B,IAAI,CAACE,OAAO,CAAC,CAAC,CAAC,CAACC,iBAAiB,CAAC;QACjD;MACJ,CAAC,CAAC,OAAOtC,KAAK,EAAE;QACZC,QAAQ,CAACD,KAAK,CAAC+B,OAAO,CAAC;MAC3B;IACJ,CAAC,EAAE,CAAC;EACR,CAAC,EAAE,CAACnC,QAAQ,CAAC,CAAC;EAEd,OACIX,KAAA,CAACsD,IAAI;IAACC,KAAK,EAAEC,MAAM,CAACC,SAAU;IAAAC,QAAA,GAC1B5D,IAAA,CAAC6D,IAAI;MACDJ,KAAK,EAAIC,MAAM,CAACI,IAAK;MAAAF,QAAA,EACxB;IAAU,CAAM,CAAC,EAEjB/C,QAAQ,GACLX,KAAA,CAAAE,SAAA;MAAAwD,QAAA,GACI1D,KAAA,CAAC2D,IAAI;QACDJ,KAAK,EAAIC,MAAM,CAACI,IAAK;QAAAF,QAAA,GACxB,OAAK,EAAC/C,QAAQ,CAACJ,QAAQ,EAAC,UAAQ,EAACI,QAAQ,CAACH,SAAS,EAAC,GACrD;MAAA,CAAM,CAAC,EACPV,IAAA,CAACH,UAAU;QAACgB,QAAQ,EAAEA;MAAS,CAAE,CAAC,EAClCX,KAAA,CAAC2D,IAAI;QAACJ,KAAK,EAAEC,MAAM,CAACrC,OAAQ;QAAAuC,QAAA,GAAC,UACjB,EAACvC,OAAO;MAAA,CACd,CAAC,EACPrB,IAAA,CAACT,SAAS;QACNwE,OAAO,EAAE9B,gBAAgB,CAACZ,OAAO,EAAER,QAAQ,CAACJ,QAAQ,EAAEI,QAAQ,CAACH,SAAS,CAAE;QAC1EsD,KAAK,EAAC;MAAiB,CAC1B,CAAC;IAAA,CACJ,CAAC,GAEHhE,IAAA,CAAAI,SAAA;MAAAwD,QAAA,EACI5D,IAAA,CAACwD,IAAI;QAACC,KAAK,EAAEC,MAAM,CAACO,mBAAoB;QAAAL,QAAA,EACpC5D,IAAA,CAAC6D,IAAI;UAAAD,QAAA,EAAE3C;QAAK,CAAO;MAAC,CAClB;IAAC,CACT,CACL;EAAA,CACC,CAAC;AAEf,CAAC;AAED,eAAeZ,gBAAgB;AAE/B,IAAMqD,MAAM,GAAGQ,UAAU,CAACC,MAAM,CAAC;EAC7BR,SAAS,EAAE;IACPS,IAAI,EAAE,CAAC;IACPC,UAAU,EAAE,QAAQ;IACpBC,cAAc,EAAE;EACpB,CAAC;EACDR,IAAI,EAAE;IACFS,UAAU,EAAE,EAAE;IACdC,UAAU,EAAE,SAAS;IACrBC,QAAQ,EAAE;EACd,CAAC;EACDR,mBAAmB,EAAE;IACjBS,KAAK,EAAE,GAAG;IACVC,MAAM,EAAE,GAAG;IACXC,WAAW,EAAE,CAAC;IACdC,WAAW,EAAEjF,MAAM,CAACkF,KAAK;IACzBC,OAAO,EAAE,EAAE;IACXT,cAAc,EAAE,QAAQ;IACxBD,UAAU,EAAE;EAChB,CAAC;EACDhD,OAAO,EAAE;IACL0D,OAAO,EAAE,EAAE;IAEXN,QAAQ,EAAE;EACd;AACJ,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}